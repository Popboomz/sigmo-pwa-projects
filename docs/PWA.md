# PWA (Progressive Web App) åŠŸèƒ½è¯´æ˜

æœ¬åº”ç”¨å·²é…ç½®ä¸ºæ¸è¿›å¼ Web åº”ç”¨ï¼ˆPWAï¼‰ï¼Œæä¾›ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°

1. **ç¦»çº¿è®¿é—®**
   - åº”ç”¨æ ¸å¿ƒèµ„æºä¼šè¢«ç¼“å­˜
   - å³ä½¿åœ¨æ— ç½‘ç»œçš„æƒ…å†µä¸‹ä¹Ÿèƒ½è®¿é—®åº”ç”¨
   - æ”¯æŒ Cache First ç­–ç•¥ï¼ˆé™æ€èµ„æºï¼‰å’Œ Network First ç­–ç•¥ï¼ˆAPI è¯·æ±‚ï¼‰

2. **æ¡Œé¢å›¾æ ‡**
   - åº”ç”¨å¯ä»¥å®‰è£…åˆ°è®¾å¤‡æ¡Œé¢
   - æ˜¾ç¤ºè‡ªå®šä¹‰å›¾æ ‡å’Œåº”ç”¨åç§°
   - ä»¥ç‹¬ç«‹çª—å£è¿è¡Œï¼Œæ— æµè§ˆå™¨åœ°å€æ 

3. **å¿«é€Ÿå¯åŠ¨**
   - Service Worker é¢„ç¼“å­˜æ ¸å¿ƒèµ„æº
   - åº”ç”¨å¯åŠ¨é€Ÿåº¦æ›´å¿«
   - æµç•…çš„ç”¨æˆ·ä½“éªŒ

4. **å®‰è£…æç¤º**
   - Chrome/Edge: è‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºå®‰è£…æç¤º
   - iOS: æ˜¾ç¤ºä¸“ç”¨çš„å®‰è£…å¼•å¯¼æ¨ªå¹…
   - Android: è‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºå®‰è£…æç¤º

5. **å“åº”å¼è®¾è®¡**
   - é€‚é…å„ç§å±å¹•å°ºå¯¸
   - æ”¯æŒæ¨ªå±å’Œç«–å±æ¨¡å¼
   - ä¼˜åŒ–çš„ç§»åŠ¨ç«¯ä½“éªŒ

6. **iOS ä¸“ç”¨æ”¯æŒ**
   - iOS è®¾å¤‡æ£€æµ‹
   - ä¸“ç”¨çš„å®‰è£…å¼•å¯¼æ¨ªå¹…
   - è¯¦ç»†çš„ iOS å®‰è£…æ­¥éª¤
   - è§†è§‰åŒ–çš„æ“ä½œæŒ‡å¼•

### ğŸš§ å¯æ‰©å±•åŠŸèƒ½

1. **æ¨é€é€šçŸ¥**
   - Service Worker å·²æ”¯æŒæ¨é€é€šçŸ¥
   - å¯åœ¨åç«¯é›†æˆæ¨é€æœåŠ¡
   - éœ€è¦ç”¨æˆ·æˆæƒ

2. **åå°åŒæ­¥**
   - æ”¯æŒç¦»çº¿æ“ä½œ
   - ç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥æ•°æ®
   - æå‡æ•°æ®å¯é æ€§

## iOS ç‰¹æ®Šè¯´æ˜

iOS Safari å¯¹ PWA çš„æ”¯æŒæ–¹å¼ä¸å…¶ä»–æµè§ˆå™¨ä¸åŒï¼š

### iOS PWA çš„ç‰¹ç‚¹

1. **æ— è‡ªåŠ¨å®‰è£…æç¤º**
   - iOS Safari ä¸æ”¯æŒ `beforeinstallprompt` äº‹ä»¶
   - ç”¨æˆ·éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°ä¸»å±å¹•
   - åº”ç”¨ä¼šæ˜¾ç¤ºä¸“ç”¨çš„å®‰è£…å¼•å¯¼

2. **å®‰è£…æ–¹å¼**
   - éœ€è¦é€šè¿‡"åˆ†äº«"æŒ‰é’®æ‰‹åŠ¨æ·»åŠ 
   - ä¸æ”¯æŒä¸€é”®å®‰è£…
   - éœ€è¦ç”¨æˆ·ä¸»åŠ¨æ“ä½œ

3. **ç‹¬ç«‹æ¨¡å¼æ£€æµ‹**
   - é€šè¿‡ `navigator.standalone` æ£€æµ‹
   - æˆ–ä½¿ç”¨ `display-mode: standalone` åª’ä½“æŸ¥è¯¢
   - æ— æ³•æ£€æµ‹åº”ç”¨æ˜¯å¦å·²å®‰è£…

### iOS å®‰è£…å¼•å¯¼

å½“ç”¨æˆ·ä½¿ç”¨ iOS è®¾å¤‡è®¿é—®æ—¶ï¼š

1. **è‡ªåŠ¨æ˜¾ç¤ºå®‰è£…æ¨ªå¹…**
   - 3 ç§’åæ˜¾ç¤ºåº•éƒ¨æ¨ªå¹…
   - æä¾›è¯¦ç»†çš„å®‰è£…æ­¥éª¤
   - å¯ä»¥å…³é—­å¹¶ç¨åæé†’

2. **PWA é¡µé¢ä¼˜åŒ–**
   - iOS è®¾å¤‡æ£€æµ‹æç¤º
   - çªå‡ºæ˜¾ç¤º iOS å®‰è£…æŒ‡å—
   - è§†è§‰åŒ–çš„æ“ä½œæ­¥éª¤

3. **æœ¬åœ°å­˜å‚¨**
   - ç”¨æˆ·å…³é—­æ¨ªå¹…åä¼šè®°å½•
   - é¿å…é‡å¤æ‰“æ‰°
   - å¯é€šè¿‡æ¸…é™¤ localStorage é‡ç½®

### iOS å®‰è£…æ­¥éª¤

1. ç‚¹å‡» Safari åº•éƒ¨çš„åˆ†äº«æŒ‰é’® (â‹)
2. å‘ä¸‹æ»šåŠ¨æ‰¾åˆ°"æ·»åŠ åˆ°ä¸»å±å¹•"
3. ç‚¹å‡»å³ä¸Šè§’çš„"æ·»åŠ "æŒ‰é’®

## æ–‡ä»¶ç»“æ„

```
public/
â”œâ”€â”€ manifest.json          # PWA é…ç½®æ–‡ä»¶
â”œâ”€â”€ sw.js                  # Service Worker
â”œâ”€â”€ favicon.ico            # ç½‘ç«™å›¾æ ‡
â””â”€â”€ icons/                 # åº”ç”¨å›¾æ ‡
    â”œâ”€â”€ icon.svg
    â”œâ”€â”€ icon-72x72.png
    â”œâ”€â”€ icon-96x96.png
    â”œâ”€â”€ icon-128x128.png
    â”œâ”€â”€ icon-144x144.png
    â”œâ”€â”€ icon-152x152.png
    â”œâ”€â”€ icon-192x192.png
    â”œâ”€â”€ icon-384x384.png
    â””â”€â”€ icon-512x512.png

src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx         # æ·»åŠ  PWA å…ƒæ•°æ®å’Œç»„ä»¶
â”‚   â””â”€â”€ pwa/
â”‚       â””â”€â”€ page.tsx       # PWA ä¿¡æ¯é¡µé¢ï¼ˆæ”¯æŒ iOSï¼‰
â””â”€â”€ components/
    â”œâ”€â”€ ServiceWorkerRegister.tsx    # Service Worker æ³¨å†Œ
    â”œâ”€â”€ PWAInstallPrompt.tsx         # Chrome/Edge å®‰è£…æç¤º
    â””â”€â”€ IOSInstallBanner.tsx         # iOS å®‰è£…å¼•å¯¼æ¨ªå¹…

scripts/
â””â”€â”€ generate-icons.js      # å›¾æ ‡ç”Ÿæˆè„šæœ¬
```

## å¦‚ä½•ä½¿ç”¨

### Chrome / Edge (æ¡Œé¢)
1. ç‚¹å‡»åœ°å€æ å³ä¾§çš„å®‰è£…å›¾æ ‡
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡»"å®‰è£…"
3. åº”ç”¨å°†æ·»åŠ åˆ°æ¡Œé¢å’Œå¼€å§‹èœå•

### iOS Safari (iPhone/iPad)
1. ç‚¹å‡» Safari åº•éƒ¨çš„åˆ†äº«æŒ‰é’® (â‹)
2. å‘ä¸‹æ»šåŠ¨å¹¶ç‚¹å‡»"æ·»åŠ åˆ°ä¸»å±å¹•"
3. ç‚¹å‡»å³ä¸Šè§’çš„"æ·»åŠ "æŒ‰é’®

### Android Chrome
1. ç‚¹å‡»åœ°å€æ å³ä¾§çš„èœå•å›¾æ ‡ (ä¸‰ä¸ªç‚¹)
2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
3. ç‚¹å‡»"æ·»åŠ "å®Œæˆå®‰è£…

### Firefox
1. ç‚¹å‡»åœ°å€æ å³ä¾§çš„å®‰è£…å›¾æ ‡
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡»"å®‰è£…"
3. åº”ç”¨å°†å®‰è£…åˆ°è®¾å¤‡ä¸Š

## æŸ¥çœ‹çŠ¶æ€

è®¿é—® `/pwa` é¡µé¢ï¼Œå¯ä»¥æŸ¥çœ‹ï¼š
- è®¾å¤‡ç±»å‹æ£€æµ‹
- å®‰è£…çŠ¶æ€
- ç½‘ç»œçŠ¶æ€
- PWA åŠŸèƒ½ç‰¹æ€§
- ä¸åŒè®¾å¤‡çš„å®‰è£…æŒ‡å—

## æŠ€æœ¯å®ç°

### manifest.json
å®šä¹‰åº”ç”¨çš„å…ƒæ•°æ®ï¼š
- åº”ç”¨åç§°å’Œæè¿°
- å›¾æ ‡é…ç½®
- ä¸»é¢˜è‰²
- æ˜¾ç¤ºæ¨¡å¼
- ä½œç”¨åŸŸ

### Service Worker
å®ç°ç¼“å­˜ç­–ç•¥ï¼š
- **é™æ€èµ„æº**: Cache Firstï¼ˆç¼“å­˜ä¼˜å…ˆï¼‰
- **API è¯·æ±‚**: Network Firstï¼ˆç½‘ç»œä¼˜å…ˆï¼Œå¤±è´¥åˆ™è¿”å›ç¼“å­˜ï¼‰
- **é¡µé¢å¯¼èˆª**: Network Firstï¼ˆç½‘ç»œä¼˜å…ˆï¼Œå¤±è´¥åˆ™è¿”å›ç¼“å­˜æˆ–é¦–é¡µï¼‰

### ç»„ä»¶
- **ServiceWorkerRegister**: è‡ªåŠ¨æ³¨å†Œ Service Worker
- **PWAInstallPrompt**: Chrome/Edge å®‰è£…æç¤ºå¯¹è¯æ¡†
- **IOSInstallBanner**: iOS ä¸“ç”¨å®‰è£…å¼•å¯¼æ¨ªå¹…

### iOS æ£€æµ‹é€»è¾‘
```javascript
// æ£€æµ‹ iOS è®¾å¤‡
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

// æ£€æµ‹ç‹¬ç«‹æ¨¡å¼ï¼ˆå·²å®‰è£…ï¼‰
const isStandalone = window.matchMedia('(display-mode: standalone)').matches
  || window.navigator.standalone === true;
```

## æ›´æ–°å›¾æ ‡

ä½¿ç”¨è„šæœ¬ç”Ÿæˆä¸åŒå°ºå¯¸çš„å›¾æ ‡ï¼š

```bash
pnpm run generate-icons
```

å›¾æ ‡è„šæœ¬ä½äº `scripts/generate-icons.js`ï¼Œä½¿ç”¨ sharp åº“ç”Ÿæˆã€‚

## æµè§ˆå™¨æ”¯æŒ

- âœ… Chrome / Edge (æ¨è)
  - æ”¯æŒè‡ªåŠ¨å®‰è£…æç¤º
  - ä¸€é”®å®‰è£…
  - å®Œæ•´ PWA æ”¯æŒ

- âœ… Firefox
  - æ”¯æŒè‡ªåŠ¨å®‰è£…æç¤º
  - ä¸€é”®å®‰è£…
  - å®Œæ•´ PWA æ”¯æŒ

- âœ… iOS Safari (iOS 11.3+)
  - éœ€è¦æ‰‹åŠ¨å®‰è£…
  - æä¾›å¼•å¯¼æ¨ªå¹…
  - å®Œæ•´ PWA æ”¯æŒ

- âœ… Android Chrome
  - æ”¯æŒè‡ªåŠ¨å®‰è£…æç¤º
  - ä¸€é”®å®‰è£…
  - å®Œæ•´ PWA æ”¯æŒ

## æ³¨æ„äº‹é¡¹

1. **HTTPS**: PWA å¿…é¡»åœ¨ HTTPS ç¯å¢ƒä¸‹è¿è¡Œï¼ˆlocalhost é™¤å¤–ï¼‰
2. **Service Worker**: éœ€è¦åœ¨ HTTPS æˆ– localhost ä¸Šæ‰èƒ½æ³¨å†Œ
3. **å›¾æ ‡**: å»ºè®®ä½¿ç”¨ PNG æ ¼å¼ï¼Œæ”¯æŒé€æ˜èƒŒæ™¯
4. **æ›´æ–°**: æ›´æ–° Service Worker åï¼Œéœ€è¦åˆ·æ–°é¡µé¢æ‰èƒ½ç”Ÿæ•ˆ
5. **iOS**: iOS éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œä¸æ”¯æŒè‡ªåŠ¨å®‰è£…

## è°ƒè¯•

### Chrome DevTools
1. æ‰“å¼€ DevTools (F12)
2. è¿›å…¥ "Application" æ ‡ç­¾
3. åœ¨å·¦ä¾§é¢æ¿å¯ä»¥çœ‹åˆ°ï¼š
   - Manifest
   - Service Workers
   - Cache Storage

### iOS Safari è°ƒè¯•
1. å°† iPhone è¿æ¥åˆ° Mac
2. åœ¨ Safari å¼€å‘èœå•ä¸­é€‰æ‹©è®¾å¤‡
3. é€‰æ‹© Web Inspector

### æ¸…é™¤ç¼“å­˜
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
caches.keys().then(keys => {
  keys.forEach(key => caches.delete(key));
});
```

### å–æ¶ˆæ³¨å†Œ Service Worker
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
navigator.serviceWorker.getRegistrations().then(registrations => {
  registrations.forEach(registration => registration.unregister());
});
```

### é‡ç½® iOS æ¨ªå¹…
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.removeItem('ios-banner-dismissed');
```

## iOS æ¨ªå¹…é…ç½®

### æ˜¾ç¤ºæ—¶æœº
- å»¶è¿Ÿ 3 ç§’æ˜¾ç¤º
- ä»…åœ¨ iOS è®¾å¤‡ä¸Šæ˜¾ç¤º
- ä»…åœ¨æœªå®‰è£…æ—¶æ˜¾ç¤º
- è®°å½•ç”¨æˆ·å…³é—­çŠ¶æ€

### æ¨ªå¹…å†…å®¹
- iOS ä¸“ç”¨æ ‡é¢˜å’Œå›¾æ ‡
- è¯¦ç»†çš„å®‰è£…æ­¥éª¤
- è§†è§‰åŒ–çš„æ“ä½œæŒ‡å¼•
- å…³é—­å’Œäº†è§£æ›´å¤šæŒ‰é’®

### æ¨ªå¹…æ ·å¼
- å›ºå®šåœ¨åº•éƒ¨
- æ¸å˜èƒŒæ™¯
- æ¯›ç»ç’ƒæ•ˆæœ
- å“åº”å¼è®¾è®¡

## å‚è€ƒèµ„æº

- [PWA æ–‡æ¡£](https://web.dev/progressive-web-apps/)
- [Manifest è§„èŒƒ](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [iOS PWA æŒ‡å—](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/PWA/PWA.html)
